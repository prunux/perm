Installation for Gedafe and Perm 2.0
=====================================

The installation of Gedafe and Perm 2.0 can be done with the following
steps, numbered with digits from 1. to 10, and have been tested on Ubuntu
18.04 LTS.

Those steps beetween the digits and numbered with A. - Z. are steps for
installing Gedafe, Perm 2.0 and Ubuntu 18.04 on AWS.

Idea on AWS is to

* use and run and AMI Image with EC2 Spot Instances oder EC2
* use the AWS Aurora PostgreSQL Database in serverless Modules

I. Initialize Create and Initialize Database
--------------------------------------------


II. Webserver Ubuntu 18.04 with perm and gedafe code
---------------------------------------------------

 1. Launch Instance with Ubuntu 18.04

   A1. Launch an Instance with Ubuntu 18.04 on AWS

      * Create and Activate AWS Account
        https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/

      * Create an EC2 Instance
        https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/launching-instance.html

 2. Login to Ubuntu 18.04 instance, gain super rights and download gedafe and perm checkouts

    ssh -i perm-test.pem ubuntu@MYINSTANCE.MYDOMAIN
    # e.g. ssh -i perm-test.pem ubuntu@ec2-54-171-159-0.eu-west-1.compute.amazonaws.com

    cd /tmp
    wget https://gitlab.com/prunux/gedafe/-/archive/master/gedafe-master.tar.gz
    wget https://gitlab.com/prunux/perm/-/archive/master/perm-master.tar.gz
    cd -

 3. create a 'gedafe' and 'perm' linux user and keep user account passwords

    sudo adduser --uid 1001 gedafe
    sudo adduser --uid 1002 perm

    # keep offline account password

 4. extract gedafe-code to /home/gedafe

    sudo tar xzvf /tmp/gedafe-master.tar.gz -C /home/gedafe

 5. extract perm-code to /home/perm

    sudo tar xzvf /tmp/perm-master.tar.gz -C /home/perm

 6. Update Ubuntu 18.04 system and install additional necessary packages for running perm and compiling necessary perl modules

    sudo apt update
    sudo apt upgrade

    sudo apt install postgresql-client-10

    sudo apt install apache2
    sudo apt install libapache2-mod-fcgid

    sudo apt install libcgi-fast-perl
    sudo apt install libdbi-perl
    sudo apt install libdbd-pg-perl
    sudo apt install libyaml-libyaml-perl

 7. Install certbot

    sudo apt-get update
    sudo apt-get install software-properties-common
    sudo add-apt-repository universe
    sudo add-apt-repository ppa:certbot/certbot
    sudo apt-get update

    sudo apt-get install certbot python-certbot-apache

8.  Preconfigure Apache

    sudo a2enmod headers
    sudo a2enmod rewrite
    sudo a2enmod ssl

 9. adapt apache configuration and configure domain

    sudo cp /home/perm/etc/apache2/sites-available/mysubdomain.mydomain.mytld.conf /etc/apache2/sites-available/mysubdomain.mydomain.mytld.conf
    sudo cp -a /home/perm/public_html/images /var/www/images

    # change MY.. to your domain name!
    sudo mv /etc/apache2/sites-available/mysubdomain.mydomain.mytld.conf /etc/apache2/sites-available/MYSUBDOMAIN.MYDOMAIN.MYLTD.conf

    # edit and configure correct domain name (needed also for TLS)
    sudo vim /etc/apache2/sites-available/MYSUBDOMAIN.MYDOMAIN.MYLTD.conf

    # enable apache perm website
    sudo a2ensite MYSUBDOMAIN.MYDOMAIN.MYLTD.conf

    # check config and if okay, restart apache
    sudo apache2ctl configtest
    sudo systemctl apache2 restart

    # enable TLS and letsencrypt
    sudo certbot --apache -d MYSUBDOMAIN.MYDOMAIN.MYLTD

    # check config and if okay, restart apache
    sudo apache2ctl configtest
    sudo systemctl apache2 restart

10. adopt database connection to correct and initialized database (see also part I. above)

    sudo vim /home/perm/public_html/db_config.yaml

11. enable gedafed systemd service at startup

    sudo cp /home/gedafe/etc/systemd/system/gedafed.service /etc/systemd/system
    sudo systemctl daemon-reload
    sudo systemctl start gedafed.service
    sudo systemctl status gedafed.service
    sudo systemctl enable gedafed.service
    sudo systemctl status gedafed.service

III. AWS handling
-----------------

IV. HISTORY
-----------


sudo apt install etckeeper


    7. install Perl Modules

    su - gedafe
    cd /home/gedafe/thirdparty
    ./build_gedafe.sh
